# javascript 性能优化

## 一、性能优化介绍

### 1、内存管理

##### 内存管理介绍

内存：可读单元组成，表示一片可操作的空间

管理：人为的操作一片空间申请，使用和释放

内存管理：申请-使用-释放

```javascript
//申请空间
let obj = {}
//使用空间
obj.name='aaa'
//释放空间
obj=null
```

### 2、垃圾回收

对象不被引用时是垃圾

对象不能被根上访问到是垃圾

可访问到的对象就是可达对象（从根出发是否能被找到，即全局变量对象）

```javascript
let obj={name:'xm'}
let ali=obj //引用
obj=null 
```

``` javascript
function objGroup(obj1,obj2){
    obj1.next=obj2
    obj2.prev=obj1
    return{
        o1:obj1,
        o2:obj2
    }
}
let obj=objGroup(
{name:'obj1'},
{name:'obj2'}
)
console.log(obj)
```

#### 2.1 GC算法

GC是一种机制，负责查找垃圾释放空间，回收空间；算法就是工作室查找和回收遵循的规则

GC里的垃圾是：程序中不需要使用的对象；程序中不能访问的对象

常见GC算法：

2. 1.1引用计数：设置引用数，判断当前引用数是否为0

   优缺点：发现垃圾立即回收，最大限度减少程序暂停；无法回收循环引用对象，时间开销大

``` javascript
const u1={age:11}
const u2={age:33}
const u3={age:44}
const nameList=[u1.age,u2.age,u3.age]
function fn(){
    const num1=1
    const num2=2   //函数内部变量，引用完就被回收，引用数为0
}
fn();
```

#### 2.1.2标记清理

实现原理：遍历所有对象标记活动对象，遍历所有对象清除没有标记对象

优缺点：解决循环引用不能回收问题，缺点造成空间碎片化，不能最大化使用

#### 2.1.3标记整理

实现原理：是标记清理的增强，标记阶段与标记清理一致。清楚阶段会先执行整理，移动对象位置

### 3、V8引擎垃圾回收

V8:主流js执行引擎，即时编译，内存设限

3.1回收策略：才有分代回收，内存分为新生代，老生代，针对不同对象采用不同算法

3.2常见GC算法：

.分代回收:新生代/老生代

.空间赋值

.标记清除

.标记整理

. 标记增量

### 4、performance 工具

#### 4.1 为什么：提供更多监控方式，监控内存

#### 4.2 内存问题的外在体现：

。页面延迟加载或经常性的暂停

。出现持续性出现糟糕性能

#### 4.3 界定内存问题的标准：

。内存泄露:内存使用持续升高

。内存膨胀：在多数设备上都存在性能问题

。频繁垃圾回收

#### 4.4 监控内存变化

浏览器任务管理器

timeline时序图

堆快照查找分离DOM

判断是否频繁存在垃圾回收

### 5 、代码性能优化

慎用全部变量：会加大时耗，降低程序内存使用，全局污染

缓存全局变量：将使用中无法避免的全局变量缓存到局部

通过原型新增方法

避开闭包陷阱  ：会出先内存泄露

避免属性访问方法使用

for循环优化

节点添加优化





